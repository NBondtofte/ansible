---
- name: Test Proxmox API connection
  hosts: local
  gather_facts: false

  vars:
    api_host: "{{ pve_host }}"
    api_user: "{{ pve_user }}"
    api_token_name: "{{ pve_token_name }}"
    api_token_value: "{{ pve_token_value }}"

  tasks:
    - name: Get Proxmox nodes
      community.general.proxmox:
        api_user: "{{ api_user }}"
        api_token_id: "{{ api_token_name }}"
        api_token_secret: "{{ api_token_value }}"
        api_host: "{{ api_host }}"
        api_port: 8006
        validate_certs: false
        state: info
      register: pve_result

    - name: Print nodes
      debug:
        var: pve_result
